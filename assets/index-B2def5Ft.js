(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=e(i);fetch(i.href,l)}})();class W{constructor(t=[],e=(n,i)=>n<i?-1:n>i?1:0){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const l=t-1>>1,r=e[l];if(n(i,r)>=0)break;e[t]=r,t=l}e[t]=i}_down(t){const{data:e,compare:n}=this,i=this.length>>1,l=e[t];for(;t<i;){let r=(t<<1)+1;const s=r+1;if(s<this.length&&n(e[s],e[r])<0&&(r=s),n(e[r],l)>=0)break;e[t]=e[r],t=r}e[t]=l}}class x{constructor(t,e,n){this.name=t,this.baseColor=e,this.cost=n}getColor(t,e,n){let i=red(this.baseColor),l=green(this.baseColor),r=blue(this.baseColor),s=map(t,e,n,.75,1.25);return color(i*s,l*s,r*s)}}let h=200,f=150,u,d,y=.04,g=null,c=null,A,S,T,N,P,b,p,D=Array(h).fill(null).map(()=>Array(f)),k=null,O=0;window.setup=function(){createCanvas(windowWidth,windowHeight),u=width/h,d=height/f,noiseDetail(7,.5),A=new x("water",color(64,123,158),10),S=new x("shore",color(238,214,175),2),T=new x("grass",color(139,172,120),1),N=new x("mountain",color(169,157,144),5),P=new x("snow",color(255,255,255),8),b=createGraphics(width,height),M(),document.getElementById("regenerate").addEventListener("click",X),document.getElementById("new-source").addEventListener("click",Y),document.getElementById("new-dest").addEventListener("click",_),loop()};function I(o){return o<.4?{terrain:A,min:0,max:.4}:o<.5?{terrain:S,min:.4,max:.5}:o<.65?{terrain:T,min:.5,max:.65}:o<.8?{terrain:N,min:.65,max:.8}:{terrain:P,min:.8,max:1}}function X(){noiseSeed(Math.random()*1e4),M(),g=null,c=null,p=!1,k=null}function Y(){g=null,c=null,p=!1,k=null}function _(){c=null,p=!1}function B(o,t){let e=Array(h).fill(null).map(()=>Array(f).fill(1/0)),n=Array(h).fill(null).map(()=>Array(f).fill(null));e[o][t]=0;let i=new W([],(l,r)=>l.dist-r.dist);for(i.push({x:o,y:t,dist:0});i.length>0;){let l=i.pop(),{x:r,y:s,dist:E}=l;if(E>e[r][s])continue;[{x:r-1,y:s,weight:1},{x:r+1,y:s,weight:1},{x:r,y:s-1,weight:1},{x:r,y:s+1,weight:1},{x:r-1,y:s-1,weight:1.4},{x:r+1,y:s-1,weight:1.4},{x:r-1,y:s+1,weight:1.4},{x:r+1,y:s+1,weight:1.4}].forEach(m=>{let a=m.x,w=m.y;if(a>=0&&a<h&&w>=0&&w<f){let L=e[r][s]+D[a][w].terrain.cost*m.weight;L<e[a][w]&&(e[a][w]=L,n[a][w]={x:r,y:s},i.push({x:a,y:w,dist:L}))}})}return console.log("DijkstraDONE!"),{distances:e,predecessors:n}}function M(){for(let o=0;o<h;o++)for(let t=0;t<f;t++){const e=noise(o*y,t*y),n=I(e);D[o][t]=n;const i=o<h-1?noise((o+1)*y,t*y):e,l=t<f-1?noise(o*y,(t+1)*y):e,r=e-i,s=e-l,E=r+s,C=map(E,-.3,.3,.4,1.6),m=constrain(C,.4,1.6);let a=n.terrain.getColor(e,n.min,n.max);b.fill(red(a)*m,green(a)*m,blue(a)*m),b.noStroke(),b.rect(o*u,t*d,u,d)}}function F(o,t){let e={x:o,y:t},{predecessors:n}=k;for(stroke(0,0,255,150),strokeWeight(4),noFill(),beginShape();e!=null;)vertex(e.x*u+u/2,e.y*d+d/2),e=n[e.x][e.y];endShape()}window.draw=function(){O<255&&(O+=5),tint(255,O),image(b,0,0),noTint(),c&&k&&F(c.x,c.y),g&&v(g.x,g.y,color(255,0,0)),c&&v(c.x,c.y,color(0,0,255))};function v(o,t,e){fill(e),stroke(255),strokeWeight(2),ellipse(o*u+u/2,t*d+d/2,u*2,d*2)}window.mouseClicked=function(){let t=document.elementFromPoint(mouseX,mouseY);if(t&&t.tagName==="BUTTON")return;let e=floor(mouseX/u),n=floor(mouseY/d);e>=0&&e<h&&n>=0&&n<f&&(g==null?(g={x:e,y:n},k=B(e,n)):p||(c={x:e,y:n},p=!0,console.log("DestPoint:",e," ",n)))};window.mouseMoved=function(){if(g&&!p){let t=floor(mouseX/u),e=floor(mouseY/d);t>=0&&t<h&&e>=0&&e<f&&(c={x:t,y:e})}};
